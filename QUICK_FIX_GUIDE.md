## Azure AD 設定手順 - メッセージ送信機能を有効にする

### 🚀 即座に修正が必要な設定

現在のエラー `AADSTS7000218` を解決するために、以下の設定を**Azure Portal**で実行してください：

#### 1. Azure Portal にサインイン
- https://portal.azure.com にアクセス
- Azure AD管理者アカウントでサインイン

#### 2. アプリ登録の設定変更

1. **Azure Active Directory** > **アプリの登録** に移動
2. アプリケーション ID `bb445ce0-e1cb-45c4-aa52-38080d78df13` を検索
3. アプリをクリックして詳細ページを開く

#### 3. 認証設定の修正 (重要)

1. 左メニューから **「認証」** をクリック
2. **「詳細設定」** セクションを見つける
3. **「パブリック クライアント フローを許可する」** を **「はい」** に変更
4. **「保存」** をクリック

#### 4. API アクセス許可の追加

1. 左メニューから **「API のアクセス許可」** をクリック
2. **「アクセス許可の追加」** をクリック
3. **「Microsoft Graph」** を選択
4. **「委任されたアクセス許可」** を選択
5. 以下の権限を検索・追加:
   - `ChannelMessage.Send`
   - `User.Read` (通常は既に存在)

#### 5. 管理者の同意を与える

1. API のアクセス許可ページで
2. **「[テナント名] に管理者の同意を与えます」** をクリック
3. 確認ダイアログで **「はい」** をクリック
4. すべての権限に緑のチェックマークが表示されることを確認

### 📋 設定確認リスト

設定完了後、以下が正しく設定されていることを確認してください：

- [ ] パブリック クライアント フロー: **有効**
- [ ] Delegated権限 `Team.ReadBasic.All`: **管理者の同意済み**
- [ ] Delegated権限 `Channel.ReadBasic.All`: **管理者の同意済み**
- [ ] Delegated権限 `ChannelMessage.Read.All`: **管理者の同意済み**
- [ ] Delegated権限 `ChannelMessage.Send`: **管理者の同意済み**
- [ ] Delegated権限 `User.Read`: **管理者の同意済み**

### 🔧 設定完了後のテスト

設定が完了したら、以下のコマンドでアプリケーションをテストしてください：

```bash
npm start
```

### 💡 期待される動作

設定が正しく完了すると：
1. **Delegated認証** でDevice Code Flowが成功する
2. ブラウザで認証コードを入力するとトークンが取得される
3. **メッセージ送信**がDelegated権限で正常に動作する
4. エラー `AADSTS7000218` が解消される

### 🚨 トラブルシューティング

#### エラー: `AADSTS7000218`
- **原因**: パブリッククライアントフローが無効
- **解決策**: 手順3の設定を確認

#### エラー: `Invalid request - User is missing`
- **原因**: ChannelMessage.Send権限が不足
- **解決策**: 手順4-5の権限設定を確認

#### エラー: `Authorization pending`
- **原因**: ユーザーが認証を完了していない
- **解決策**: Device Code認証で表示されるURLにアクセスしてコードを入力

---

設定が完了したら、`npm start` でアプリケーションをテストしてください。
